version: '3.9'

services:
  django-web:
    build: ./backend
    container_name: django
    env_file: .env
    volumes:
      - ./backend/static:/app/staticfiles
    networks:
      - billing-network
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${SECRET_KEY}
      - DEBUG=${DEBUG}
      - MIKROTIK_URL=${MIKROTIK_URL}
      - MIKROTIK_USER=${MIKROTIK_USER}
      - MIKROTIK_PASS=${MIKROTIK_PASS}

  nextjs:
    build: ./frontend
    container_name: nextjs
    networks:
      - billing-network
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost/api/v1

  nginx:
    image: nginx:alpine
    container_name: nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./backend/static:/static:ro
    depends_on:
      - django-web
      - nextjs
    networks:
      - billing-network

networks:
  billing-network:
    driver: bridge
